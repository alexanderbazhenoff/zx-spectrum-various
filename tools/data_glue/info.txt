:data glue utility v1.0
::by alx/brainwave


::с чего вся херня началась?

я  окончательно запарился обрезать "хвосты" файлов и собирать их
в отдельный файл в ручную. "борьба" за компактность программ до-
вела меня до полных маразмов (?) в виде экономии на межсекторном
пространстве.  раньше, когда я делал crack игрушки с кучей подг-
ружаемых блоков на эту операцию уходила туева хуча времени (осо-
бенно  задалбывало  объединять  эти хвосты и создавать их табицу
расположения). в  результате некоторого  ментального долбоебизма
родилась утилита под выше упомянутым названием...


::нахера это все надо?

известно, что зачастую упакованные файлы занимают не весь после-
дний  сектор  дискового  пространства. подобного рода промежутки
можно,  конечно,  заполнят надписями  типа  "made by her-na-rool
team! vasya pupkin roxx!", но что делать когда таких блоков дос-
таточно много? теперь у вас есть способ свести количество подоб-
ных  межсекторных надписей к одной-двум... как вы уже понимаете,
данная  программа побайтно склеивает блоки различной длины, соз-
давая один непрерывный массив данных.


::как эта херня работает?

после  запуска утилиты вам предлогается выбрать "дисковод-источ-
ник"  и "дисковод-приемник", после чего следует нажать на enter.
дальше начнется самое интересное... ;)

программа  поочередно  будет  искать  на  диске  файлы  с именем
'blokXXX.R', где XXX - номер файла (000...127). привести все ис-
ходные  файы к такому виду можно с помощью mren1.x (плагин такой
к  real  comander'у).  обязательно следите за тем,  чтобы номера
файлов следовали непрерывно. порядок расположения файлов на дис-
ке значения не имеет. если файл с очередным номером на диске от-
сутствует, программа приступит к сохранению заголовков уже скле-
енного массива в виде:  'glued_a.C', 'glued_b.C', 'glued_c.C'  и
т. д. так-же будет сохранен файл-index вида 'index#XX', где XX -
кол-во склееных файлов. формат index'а следующий:

на каждый склеенный блок приходится по 4 байта информации:
+00,+01,+02 - смещение от начала данных в виде. расположение
              байтов следующее: младший, средний, старший
+03         - старший байт длины блока данных

расчитать адрес index-информации для блока A можно так:
            add a,a
            add a,a
            ld hl,index_addr
            ld e,0
            ld d,a
            add hl,de
в HL получим искомый адрес

местоположение блока на диске и количество секторов, которые не-
обходимо для этого считать можно дальше рассчитать так:
            ld a,(hl)
            inc hl
            ld e,(hl)
            inc hl
            ld d,(hl)
            inc hl
            ld b,(hl)
            or a            ;если блок находится не с начала
            jr nz,secs_nad  ;сектора для надежности прийдется
            inc b           ;считать на сектор больше
secs_nad    ex af,af'
            ld hl,tr_sec    ;трек/сектор с которого начинаются
sec_adl     ld a,e          ;склееные данные (в некоторых слу-
            or d            ;чаях можно взять из #5CF4)
            jr z,sec_ade
            inc e
            bit 4,e
            jr z,trk_nad
            inc d
            ld e,0
trk_nad     inc de
            jr sec_adl
sec_ade     ex af,af'
в регистре B получим кол-во секторов для считывания, а в DE -
откуда считывать.

в приложении к программе вы можете найти уже готовую п/п загруз-
ки.


::а не пошел бы я нахер?

[-] так-как программу я писал для себя да и сильно над ней не
    парился, интерфейс почти-что отсутствует. да, мне думатся,
    совершенно не нужен
[-] версия утилиты достаточно "сырая" и хорошо протестить я ее
    еще не успел - возможна куча жуков и тараканов :)
[-] дисковые ошибки перехватываются, но еще не совсем корректно.
[?] максимальная длина склеиваемого файла #9E00. склеивать более
    длинные файлы,  думаю,  вам не прийдется - вряд ли так плохо
    запакуется. Советую пользоваться rip'ом (тогда точно не при-
    йдется).
[+] все дисковые операции через #3D13


::прочая херня...

комплект поставки:

DGlue1_0.B   собственно, сама утилита
DGlue1_0.C
Dglue1_0.H   исходник в формате ALASM для любопытных и не только
GlueLoad.H   универсальная п/п загрузки склеенных данных (ALASM)
dglue1_0.txt догадайтесь сами... :)

приветы:

cpu, tbk, 4d, triumph, bis, mooh, skrju, n-discovery, pos-wt, dr
placebo, invaders, axor, paul pavlov, cc и многим другим...

контакты:

neehooya@pisem.net - прямо мне в мыло, но читаю редко
jeffie@bwteam.org  - через него тоже можно и так быстрее




о1.о9.2оо5 11:16 а. м.
alx//brainwave team
